<?xml version="1.0" encoding="UTF-8"?>

<resource oid="04afeda6-394b-11e6-8cbe-abf7ff430056"
    xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
    xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
    xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3"
    xmlns:ext="http://midpoint.evolveum.com/xml/ns/story/orgsync/ext"
    xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3"
    xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3"
    xmlns:my="http://myself.me/schemas/whatever">

       <name>Sistema Acad√©mico</name>

    <connectorRef type="ConnectorType">
        <filter>
            <q:equal>
            <q:path>c:connectorType</q:path>
              <q:value>org.identityconnectors.databasetable.DatabaseTableConnector</q:value>
            </q:equal>
          </filter>
    </connectorRef>

    <connectorConfiguration>

        <icfc:configurationProperties
        xmlns:icscdbtable="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-databasetable/org.identityconnectors.databasetable.DatabaseTableConnector">
            <icscdbtable:port>5433</icscdbtable:port>
            <icscdbtable:host>192.168.25.6</icscdbtable:host>
            <icscdbtable:user>academico</icscdbtable:user>
            <icscdbtable:password><clearValue>secret</clearValue></icscdbtable:password>
            <icscdbtable:database>academico</icscdbtable:database>
            <icscdbtable:table>estudiantes</icscdbtable:table>
            <icscdbtable:keyColumn>userid</icscdbtable:keyColumn>
            <icscdbtable:passwordColumn>password</icscdbtable:passwordColumn>
            <icscdbtable:jdbcDriver>org.postgresql.Driver</icscdbtable:jdbcDriver>
            <icscdbtable:jdbcUrlTemplate>jdbc:postgresql://%h:%p/%d</icscdbtable:jdbcUrlTemplate>
            <icscdbtable:enableEmptyString>false</icscdbtable:enableEmptyString>
            <icscdbtable:rethrowAllSQLExceptions>true</icscdbtable:rethrowAllSQLExceptions>
            <icscdbtable:nativeTimestamps>false</icscdbtable:nativeTimestamps>
            <icscdbtable:allNative>false</icscdbtable:allNative>
            <icscdbtable:changeLogColumn>change_timestamp</icscdbtable:changeLogColumn>
        </icfc:configurationProperties>

    </connectorConfiguration>

    <schemaHandling>
        <objectType>
            <kind>account</kind>
            <displayName>Default Account</displayName>
            <default>true</default>
            <objectClass>ri:AccountObjectClass</objectClass>
            <delineation>
                <objectClass>ri:AccountObjectClass</objectClass>
            </delineation>            
            <focus>
                <type>c:UserType</type>
            </focus>       
            <attribute>
                <ref>icfs:uid</ref>
                <displayName>User ID</displayName>
                <limitations>
                    <access>
                        <read>true</read>
                        <add>true</add>
                        <modify>true</modify>
                    </access>
                </limitations>
            </attribute>
            <attribute>
                <ref>icfs:name</ref>
                <displayName>Name</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <access>
                        <read>true</read>
                        <add>true</add>
                        <modify>true</modify>
                    </access>                        
                </limitations>
                <!-- <outbound>
                    <source>
                        <path>$user/name</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:name</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:empno</ref>
                <displayName>empno</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <access>
                        <read>true</read>
                        <add>true</add>
                        <modify>true</modify>
                    </access>
                </limitations>
                <!-- <outbound>
                    <source>
                        <path>$focus/employeeNumber</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:employeeNumber</path>
                    </target>
                </inbound>
                <inbound>
                    <expression>
                        <value>
                            <!-- Employee role -->
                            <targetRef oid="86d3b462-2334-11ea-bbac-13d84ce0a1df" type="RoleType"/>
                        </value>
                    </expression>
                    <target>
                        <path>assignment</path>
                    </target>
                </inbound>
            </attribute>

            <attribute>
                <ref>ri:first_name</ref>
                <displayName>First name</displayName>
                <!-- <outbound>
                    <source>
                        <path>$focus/givenName</path>
                    </source>
                </outbound> --> 
                <inbound>
                    <target>
                        <path>c:givenName</path>
                    </target>
                </inbound>
                             
            </attribute>
            <attribute>
                <ref>ri:last_name</ref>
                <displayName>Last name</displayName>
                <!-- <outbound>
                    <source>
                        <path>$focus/familyName</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:familyName</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:email</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/emailAddress</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:emailAddress</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:locality</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/locality</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:locality</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:telephone_number</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/telephoneNumber</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path>c:telephoneNumber</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:jobcode</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/jobcode</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen775="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen775:jobCode</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:sede</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/sede</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen576="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen576:sede</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:modalidad_estudio</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/modalidad_estudio</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen834="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen834:modalidad_estudio</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:program_short_name</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/program_short_name</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen546="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen546:program_short_name</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:program_name</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/program_name</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen359="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen359:program_name</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:card_number</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/card_number</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen530="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen530:card_number</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:contract_expiry_date</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/contract_expiry_date</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen488="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen488:contract_expiry_date</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:country</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/country</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen624="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen624:country</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:creation_date</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/creation_date</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen65="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen65:creation_date</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:date_of_birth</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/date_of_birth</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen353="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen353:date_of_birth</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:emailpro</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/emailpro</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen905="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen905:emailpro</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:sigla_facultad</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/sigla_facultad</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen232="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen232:sigla_facultad</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:gender</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/gender</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen929="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen929:gender</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:postal_address</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/postal_address</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen621="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen621:postal_address</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:region</ref>
                <!-- <outbound>
                    <source>
                        <path>$focus/extension/region</path>
                    </source>
                </outbound> -->
                <inbound>
                    <target>
                        <path xmlns:gen963="https://midpoint.upeu.edu.pe/xml/ns/midpoint/schema">c:extension/gen963:region</path>
                    </target>
                </inbound>
            </attribute>
            
            <activation>
            <!--Mapeo de activaci√≥n para este recurso.
            Lo usamos para deshabilitar al usuario en midPoint 
            si la cuenta est√° marcada como RETIRADA en el recurso fuente. 
            Hacemos esto configurando este mapeo simple:-->
                <administrativeStatus>
                    <inbound>
                        <strength>weak</strength>
                    </inbound>
                </administrativeStatus>
            </activation>

            <credentials>
                    <password>
                        <!--<outbound/>-->
                        <inbound>
                            <strength>weak</strength>
                            <!--Se implementa un mapeo de asignaci√≥n d√©bil desde 
                            el recurso fuente para generar contrase√±as aleatorias 
                            solo para nuevos usuarios, preservando contrase√±as existentes 
                            durante operaciones de modificaci√≥n.-->
                            <expression>
                                <generate/>
                            </expression>
                        </inbound>
                    </password>
            </credentials>

            <projection>
                <assignmentPolicyEnforcement>none</assignmentPolicyEnforcement>
            </projection>
            
        </objectType>
    </schemaHandling>

    <capabilities xmlns:cap="http://midpoint.evolveum.com/xml/ns/public/resource/capabilities-3">
        <configured>
            <cap:activation>
            <!--Esta secci√≥n se configura manualmente.
            Esta capacidad informa sobre habilitar/deshabilitar el indicador de activaci√≥n:
            Aqu√≠ hay otro ejemplo. M√°s info en: https://docs.evolveum.com/midpoint/demo/
                <cap:status>
                    <cap:attribute>ri:emptype</cap:attribute>
                    <cap:enableValue>FTE</cap:enableValue>
                    <cap:enableValue>PTE</cap:enableValue>
                    <cap:enableValue>CONTRACTOR</cap:enableValue>
                    <cap:disableValue>RETIRED</cap:disableValue>
                    <cap:ignoreAttribute>false</cap:ignoreAttribute>
                </cap:status> -->
                <cap:status>
                    <cap:attribute>ri:disabled</cap:attribute>
                    <cap:enableValue></cap:enableValue>
                    <cap:enableValue>false</cap:enableValue>
                    <cap:disableValue>true</cap:disableValue>
                </cap:status>
            </cap:activation>
        </configured>
    </capabilities>

    <!--Esta sincronizaci√≥n estaba en la platilla original, parece que ya es obsoleta, pero si funciona-->
    <synchronization>
            <objectSynchronization>
                <!--La sincronizaci√≥n de este recurso est√° activada.
                Significa que la sincronizaci√≥n reaccionar√° a los cambios detectados por
                el sistema (tarea de sincronizaci√≥n en directo, descubrimiento o reconciliaci√≥n) -->
                <enabled>true</enabled>
                <!--Este recurso est√° configurado como una fuente autorizada.
                Significa que midPoint crear√° un usuario cuando se encuentre un nuevo 
                registro y actualizar√° al usuario cuando se actualice un registro-->
                <correlation>
                    <q:description>
                        La expresi√≥n de correlaci√≥n es una consulta de b√∫squeda.
                        La siguiente consulta de b√∫squeda buscar√° usuarios que tengan "name"
                        igual al atributo "name" de la cuenta. En pocas palabras,
                        buscar√° coincidencias en los nombres de usuario en el IDM y en el recurso.
                        La regla de correlaci√≥n siempre busca usuarios, por lo que no coincidir√° con
                        ning√∫n otro tipo de objeto.
                    </q:description>
                    <q:equal>
                        <q:path>employeeNumber</q:path>
                        <expression>
                            <path>$projection/attributes/empno</path>
                        </expression>
                    </q:equal>
                </correlation>

                <!-- La regla de confirmaci√≥n puede estar aqu√≠, pero como la b√∫squeda anterior siempre
                     devuelve como m√°ximo una coincidencia, la regla de confirmaci√≥n no es necesaria. -->

                <!-- A continuaci√≥n se describen las reacciones ante una situaci√≥n.
                     La configuraci√≥n aqu√≠ asume que este recurso es autoritativo,
                     por lo tanto todas las cuentas creadas en el recurso deber√≠an
                     reflejadas como nuevos usuarios en IDM.
                     V√©ase http://wiki.evolveum.com/display/midPoint/Synchronization+Situations
                 -->
                <reaction>
                    <situation>linked</situation>
                    <action>
                        <handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#modifyUser</handlerUri>
                    </action>
                </reaction>
                <reaction>
                    <situation>deleted</situation>
                    <action>
                        <handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#unlinkAccount</handlerUri>
                    </action>
                </reaction>
                <reaction>
                    <situation>unlinked</situation>
                    <action>
                        <handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#linkAccount</handlerUri>
                    </action>
                </reaction>
                <reaction>
                    <situation>unmatched</situation>
                    <!-- La referencia a la plantilla de usuario est√° aqu√≠. Si el usuario se
                         creado como resultado de esta acci√≥n, se crear√° seg√∫n
                         a esta plantilla. -->
                    <objectTemplateRef oid="22f83022-b76d-11e9-8a30-6ffc11b23016" type="c:ObjectTemplateType"/>
                    <action>
                        <handlerUri>http://midpoint.evolveum.com/xml/ns/public/model/action-3#addUser</handlerUri>
                    </action>
                </reaction>
            </objectSynchronization>
        </synchronization>

</resource>
